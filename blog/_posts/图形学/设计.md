---
title: 设计
date: 2019-12-19
tags:
 - 图形学
categories:
 -  CG
---


# 设计

本程序共设计了三对着色器代码，实际运行中共有四对着色器程序参与。其中，一对着色器用于生成阴影的深度数据，一对用于生成供点击判定用的帧缓存数据，剩余的则用于生成镜面纹理和显示。对于每一帧图像，程序实际上需要渲染三次：

- 第一次将摄像机放置在光源位置，拍摄所有能生成阴影的物体，将他们的深度信息保存下来，供后续分析使用；
- 第二次将摄像机放置在关于银幕平面对称的位置，并将光源也对称过来放置，拍摄此时的图像，作为银幕镜面倒影的贴图；
- 第三次将摄像机放置在真正观察的位置，对于银幕，其贴图由原有形状纹理、阴影贴图和镜面倒影贴图混合而成，而对于猫模型，其贴图由原有颜色纹理和阴影贴图混合而成。

@flowstart
st=>start: 渲染开始
e=>end: 结束
shadow=>operation: 渲染阴影深度到帧缓存1|:>阴影贴图.html
mirror=>operation: 渲染镜面映像到帧缓存2|:>倒影效果.html
render=>operation: 使用帧缓存1和帧缓存2渲染显示|:>光线设计.html

st->shadow->mirror->render->e
@flowend


接下来将分析三次渲染的具体原理和一些其他的细节设计。

